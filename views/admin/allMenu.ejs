<%- include('../includes/head&side.ejs') %>


    <section class="vh-100 gradient-custom p-4 ">



        <div class="container-fluid">
            <div class="row">
                <div class=" container-fluid">
                    <link rel="stylesheet" href="/assets/css/bootstrap-table.min.css">
                    <script src="/assets/js/bootstrap-table.min.js"></script>
                    <div id="galleryToolbar">
                        <button id='deletePost' type="button" class="btn btn-danger mx-1 ">حذف</button>
                        <button id='createPost' type="button" class="btn btn-success mx-1 " data-toggle="modal"
                            data-target="#myModal">ساخت فهرست</button>
                        <div id="myModal" class="modal fade " role="dialog">
                            <div class="modal-dialog modal-lg">
                                <div class="modal-content">
                                    <div class="modal-header">

                                        <link rel="stylesheet" href="/menuBuilder/bootstrap-iconpicker/css/all.min.css">
                                        <link rel="stylesheet"
                                            href="/menuBuilder/bootstrap-iconpicker/css/bootstrap-iconpicker.min.css">

                                        <style type="text/css">
                                            .container {
                                                margin: 150px auto;
                                            }

                                            body {
                                                background-color: #fafafa;
                                            }

                                            ol.example li.placeholder:before {
                                                position: absolute;
                                            }

                                            .list-group-item>div {
                                                margin-bottom: 5px;
                                            }
                                        </style>
                                        <div>
                                            <h5 class=' modal-title '>ساخت فهرست</h5>
                                        </div>
                                    </div>
                                    <div class="modal-body">
                                        <div class="container my-0">
                                            <div id="carbon-block" align="center"></div>
                                            <div class="jquery-script-ads" align="center">
                                                <script type="text/javascript">
                                                    google_ad_client = "ca-pub-2783044520727903";
                                                    /* jQuery_demo */
                                                    google_ad_slot = "2780937993";
                                                    google_ad_width = 728;
                                                    google_ad_height = 90;
                                                </script>

                                            </div>
                                            <div class="row">

                                            </div>
                                            <div class="row">
                                                <div class="col-md-6">
                                                    <div class="card mb-3">
                                                        <div class="card-header">
                                                            <h5 class="float-left">فهرست</h5>

                                                        </div>
                                                        <div class="card-body">
                                                            <ul id="myEditor" class="sortableLists list-group">
                                                            </ul>
                                                        </div>
                                                    </div>
                                                    <div class="card">
                                                        <div class="card-header">JSON نمایش
                                                            <div class="float-right">
                                                                <button id="btnOutput" type="button"
                                                                    class="btn btn-info">نمایش</button>
                                                                <button id="btnSave" type="button"
                                                                    class="btn btn-success">ذخیره</button>
                                                            </div>
                                                        </div>
                                                        <div class="card-body">
                                                            <div class="form-group"><textarea id="out"
                                                                    class="form-control" cols="50" rows="10"></textarea>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                                <div class="col-md-6">
                                                    <div class="card border-primary mb-3">
                                                        <div class="card-header bg-primary text-white">ویرایش</div>
                                                        <div class="card-body">
                                                            <form id="frmEdit" class="form-horizontal">
                                                                <div class="form-group">
                                                                    <label for="text">Text</label>
                                                                    <div class="input-group">
                                                                        <input type="text"
                                                                            class="form-control item-menu" name="text"
                                                                            id="text" placeholder="Text">
                                                                        <div class="input-group-append">
                                                                            <button type="button" id="myEditor_icon"
                                                                                class="btn btn-outline-secondary"></button>
                                                                        </div>
                                                                    </div>
                                                                    <input type="hidden" name="icon" class="item-menu">
                                                                </div>
                                                                <div class="form-group">
                                                                    <label for="href">URL</label>
                                                                    <input type="text" class="form-control item-menu"
                                                                        id="href" name="href" placeholder="URL">
                                                                </div>
                                                                <div class="form-group">
                                                                    <label for="target">Target</label>
                                                                    <select name="target" id="target"
                                                                        class="form-control item-menu">
                                                                        <option value="_self">Self</option>
                                                                        <option value="_blank">Blank</option>
                                                                        <option value="_top">Top</option>
                                                                    </select>
                                                                </div>

                                                            </form>
                                                        </div>
                                                        <div class="card-footer">
                                                            <button type="button" id="btnUpdate" class="btn btn-primary"
                                                                disabled><i class="fas fa-sync-alt"></i> Update</button>
                                                            <button type="button" id="btnAdd" class="btn btn-success"><i
                                                                    class="fas fa-plus"></i>
                                                                Add</button>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                        <script src="/menuBuilder/bootstrap-iconpicker/js/jquery-3.6.0.js"></script>
                                        <script
                                            src="/menuBuilder/bootstrap-iconpicker/js/bootstrap.bundle.min.js"></script>
                                        <script src='/menuBuilder/jquery-menu-editor.js'></script>
                                        <script type="text/javascript"
                                            src="/menuBuilder/bootstrap-iconpicker/js/iconset/fontawesome5-3-1.min.js"></script>
                                        <script type="text/javascript"
                                            src="/menuBuilder/bootstrap-iconpicker/js/bootstrap-iconpicker.min.js"></script>
                                        <script>
                                            jQuery(document).ready(function () {
                                                /* =============== DEMO =============== */
                                                // menu items
                                                var arrayjson = [{ "href": "http://home.com", "icon": "fas fa-home", "text": "Home", "target": "_top", "title": "My Home" }, { "icon": "fas fa-chart-bar", "text": "Opcion2" }, { "icon": "fas fa-bell", "text": "Opcion3" }, { "icon": "fas fa-crop", "text": "Opcion4" }, { "icon": "fas fa-flask", "text": "Opcion5" }, { "icon": "fas fa-map-marker", "text": "Opcion6" }, { "icon": "fas fa-search", "text": "Opcion7", "children": [{ "icon": "fas fa-plug", "text": "Opcion7-1", "children": [{ "icon": "fas fa-filter", "text": "Opcion7-1-1" }] }] }];
                                                // icon picker options
                                                var iconPickerOptions = { searchText: "Buscar...", labelHeader: "{0}/{1}" };
                                                // sortable list options
                                                var sortableListOptions = {
                                                    placeholderCss: { 'background-color': "#cccccc" }
                                                };

                                                var editor = new MenuEditor('myEditor', { listOptions: sortableListOptions, iconPicker: iconPickerOptions });
                                                editor.setForm($('#frmEdit'));
                                                editor.setUpdateButton($('#btnUpdate'));
                                                $('#btnReload').on('click', function () {
                                                    editor.setData(arrayjson);
                                                });

                                                $('#btnOutput').on('click', function () {
                                                    var str = editor.getString();
                                                    if (str === '[]') { return }
                                                    $("#out").text(str);
                                                });

                                                $('#btnSave').on('click', function (e) {
                                                    var str = editor.getString();
                                                    const navArray = JSON.parse(str)
                                                    fetch("/admin/addMenu", {
                                                        method: 'POST', headers: {
                                                            'Content-Type': 'application/json',
                                                        }, body:str
                                                    })
                                                        .then(response => { return response.json() })
                                                        .then(result => { console.log(result) })
                                                        .catch(err => console.log(err))
                                                    // $.ajax({
                                                    //     type: 'POST',
                                                    //     url: '/admin/addMenu',
                                                    //     data: { navData: navArray },
                                                    //     success: function (result) {
                                                    //         console.log(result)
                                                    //         window.location.replace('/admin/menus')
                                                    //     }
                                                    //     , error: function (result) {
                                                    //         window.localStorage.replace('/admin/menus')
                                                    //     }
                                                    // })
                                                });


                                                $("#btnUpdate").click(function () {
                                                    if ($("#text").val() === '') { return }
                                                    editor.update();
                                                });

                                                $('#btnAdd').click(function (e) {
                                                    if ($("#text").val() === '') { return }
                                                    if ($('#href').val() === '') { $('#href').val('#') }
                                                    editor.add();
                                                });
                                            });



                                        </script>


                                        <!-- Preview-->
                                        <div id='preview'></div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <table id="table" data-toggle="table" data-flat="true" data-search="true" data-height='500'
                        data-toolbar="#galleryToolbar" data-url="http://localhost:3000/admin/menuData">
                        <thead>
                            <tr>
                                <th data-field="title" data-sortable="true">نام</th>
                                <th data-field="createdAt" data-sortable="true">زمان ساخت</th>
                                <th data-field="content" data-formatter="pick">انتخاب</th>
                                <th data-field="state" data-checkbox="true"></th>
                            </tr>
                        </thead>
                    </table>
                </div>
            </div>
        </div>
        <script>
            function pick(value, row, index) {
                return [
                    `<button id='editPost' onclick="pickPost(this)" type="button" class="btn btn-info m-0 p-1">ویرایش/مشاهده</button>`
                ].join('');
            }
        </script>

    </section>

    <%- include('../includes/footer.ejs') %>